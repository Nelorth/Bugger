<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:a="http://xmlns.jcp.org/jsf/passthrough">
<ui:composition template="/WEB-INF/template/main.xhtml">
    <f:metadata>
        <f:importConstants type="tech.bugger.global.util.Constants" var="Constants"/>
    </f:metadata>

    <ui:param name="title" value="#{labels.administration}"/>
    <ui:define name="content">

        <!-- useful links for managing the users in the system -->
        <h:outputText value="#{labels.user_management}" styleClass="h2"/>
        <h:panelGroup>
            <h:link value="#{labels.browse}"
                    outcome="pretty:search"
                    styleClass="btn btn-secondary">
                <f:param name="t" value="USER"/><!-- user results tab on the search page -->
                <f:param name="q" value=""/><!-- empty query string => all results displayed -->
            </h:link>
            <h:link value="#{labels.create}"
                    outcome="pretty:profile-edit"
                    styleClass="btn btn-primary">
                <f:param name="c" value="true"/><!-- empty profile-edit username = "create user" -->
            </h:link>
        </h:panelGroup>

        <!-- organization settings form -->
        <h:outputText value="#{labels.organization_settings}" styleClass="h2"/>
        <h:form id="f-organisation" enctype="multipart/form-data">
            <h:panelGrid columns="2">

                <!-- organization name -->
                <h:outputLabel id="o-name" for="it-name" value="#{labels.name}"/>
                <h:inputText id="it-name"
                             value="#{adminBacker.organization.name}"
                             a:maxlength="#{Constants.SMALL_FIELD}"
                             a:placeholder="#{labels.organization_name_placeholder}"
                             styleClass="form-control#{component.valid ? '' : ' error'}">
                    <f:validateLength maximum="#{Constants.SMALL_FIELD}"/>
                </h:inputText>
                <h:panelGroup/>
                <h:panelGroup>
                    <h:outputLabel id="ot-name-hint"
                                  value="#{labels.organization_name_hint}"
                                  styleClass="small form-text text-muted"/>
                    <h:message for="it-name" styleClass="error"/>
                </h:panelGroup>

                <!-- organization logo (later) -->
                <h:outputLabel id="o-logo" for="g-logo" value="#{labels.logo}"/>
                <h:panelGrid columns="1">
                    <!-- TODO upgrade to real image from DB -->
                    <h:graphicImage id="g-logo"
                                    library="images"
                                    name="bugger.png"
                                    width="100" height="100"/>
                    <h:inputFile id="i-logo"
                                 validator="imageValidator"
                                 valueChangeListener="#{adminBacker.uploadLogo}"
                                 styleClass="form-control-file"/>
                    <h:panelGroup>
                        <h:selectBooleanCheckbox id="s-remove-logo" valueChangeListener="#{adminBacker.removeLogo}"/>
                        <h:outputLabel id="o-remove-logo" for="s-remove-logo" value="#{labels.remove}"/>
                    </h:panelGroup>
                </h:panelGrid>
                <h:panelGroup/>
                <h:message for="i-logo" styleClass="error"/>

                <!-- organization theme -->
                <h:outputLabel id="o-theme" for="s-theme" value="#{labels.theme}"/>
                <h:selectOneMenu id="s-theme"
                                 styleClass="form-control#{component.valid ? '' : ' error'}"
                                 value="#{adminBacker.organization.theme}">
                    <f:selectItems value="#{adminBacker.availableThemes}"/>
                </h:selectOneMenu>
                <h:panelGroup/>
                <h:panelGroup>
                    <h:message for="s-theme" styleClass="error"/>
                    <h:outputLabel id="ot-theme-hint"
                                  value="#{labels.organization_theme_hint}"
                                  styleClass="small form-text text-muted"/>
                </h:panelGroup>

                <!-- organization imprint (Markdown) -->
                <h:outputLabel id="o-imprint" for="it-imprint" value="#{labels.imprint}"/>
                <h:inputTextarea id="it-imprint"
                                 value="#{adminBacker.organization.imprint}"
                                 a:maxlength="#{Constants.LARGE_AREA}"
                                 styleClass="form-control#{component.valid ? '' : ' error'}">
                    <f:validateLength maximum="#{Constants.LARGE_AREA}"/>
                </h:inputTextarea>
                <h:panelGroup/>
                <h:message for="it-imprint" styleClass="error"/>

                <!-- organization privacy policy (Markdown) -->
                <h:outputLabel id="o-privacy-policy" for="it-privacy-policy" value="#{labels.privacy_policy}"/>
                <h:inputTextarea id="it-privacy-policy"
                                 value="#{adminBacker.organization.privacyPolicy}"
                                 a:maxlength="#{Constants.LARGE_AREA}"
                                 styleClass="form-control#{component.valid ? '' : ' error'}">
                    <f:validateLength maximum="#{Constants.LARGE_AREA}"/>
                </h:inputTextarea>
                <h:panelGroup/>
                <h:message for="it-privacy-policy" styleClass="error"/>

                <!-- organization support information (Markdown) -->
                <h:outputLabel id="o-support-info" for="it-support-info" value="#{labels.support_info}"/>
                <h:inputTextarea id="it-support-info"
                                 value="#{adminBacker.organization.supportInfo}"
                                 a:maxlength="#{Constants.LARGE_AREA}"
                                 styleClass="form-control#{component.valid ? '' : ' error'}">
                    <f:validateLength maximum="#{Constants.LARGE_AREA}"/>
                </h:inputTextarea>
                <h:panelGroup/>
                <h:message for="it-support-info" styleClass="error"/>
            </h:panelGrid>
            <h:commandButton value="#{labels.save}"
                             action="#{adminBacker.saveOrganization}"
                             styleClass="btn btn-primary"/>
        </h:form>

        <!-- application configuration form -->
        <h:outputText value="#{labels.configuration_settings}" styleClass="h2"/>
        <h:form id="f-configuration">
            <h:panelGrid columns="2">
                <!-- guest reading policy -->
                <h:outputText value="#{labels.guest_reading}"/>
                <h:panelGroup>
                    <h:selectBooleanCheckbox id="s-guest-reading"
                                             value="#{adminBacker.configuration.guestReading}"
                                             styleClass="form-check-input"/>
                    <h:outputLabel id="o-guest-reading"
                                   for="s-guest-reading"
                                   value="#{labels.guest_reading_detail}"/>
                </h:panelGroup>
                <h:panelGroup/>
                <h:message for="s-guest-reading" styleClass="error"/>

                <!-- closed report policy -->
                <h:outputText value="#{labels.closed_report_posting}"/>
                <h:panelGroup>
                    <h:selectBooleanCheckbox id="s-closed-report-posting"
                                             value="#{adminBacker.configuration.closedReportPosting}"
                                             styleClass="form-check-input"/>
                    <h:outputLabel id="o-closed-report-posting" for="s-closed-report-posting"
                                   value="#{labels.closed_report_posting_detail}"/>
                </h:panelGroup>
                <h:panelGroup/>
                <h:message for="s-closed-report-posting" styleClass="error"/>

                <!-- user e-mail address format -->
                <h:outputLabel id="o-user-email-format"
                               for="s-user-email-format"
                               value="#{labels.user_email_format}"/>
                <h:inputText id="s-user-email-format"
                             value="#{adminBacker.configuration.userEmailFormat}"
                             validator="regexValidator"
                             a:maxlength="#{Constants.LARGE_FIELD}"
                             styleClass="form-control#{component.valid ? '' : ' error'}">
                    <f:validateLength maximum="#{Constants.LARGE_FIELD}"/>
                </h:inputText>
                <h:panelGroup/>
                <h:panelGroup>
                    <h:message for="s-user-email-format" styleClass="error"/>
                    <h:outputLabel id="ot-user-email-format-hint"
                                  value="#{labels.user_email_format_hint}"
                                  styleClass="small form-text text-muted"/>
                </h:panelGroup>


                <!-- definition of a user's voting weight -->
                <h:outputLabel id="o-voting-weight-definition"
                               for="it-voting-weight-definition"
                               value="#{labels.voting_weight_definition}"/>
                <h:inputText id="it-voting-weight-definition"
                             value="#{adminBacker.configuration.votingWeightDefinition}"
                             a:maxlength="#{Constants.LARGE_FIELD}"
                             styleClass="form-control#{component.valid ? '' : ' error'}">
                    <f:validateLength maximum="#{Constants.LARGE_FIELD}"/>
                    <f:validateRegex pattern="#{Constants.INTEGER_LIST_REGEX}"/>
                </h:inputText>
                <h:panelGrid/>
                <h:panelGrid>
                    <h:message for="it-voting-weight-definition" styleClass="error"/>
                    <h:outputLabel id="ot-voting-weight-definition-hint"
                                  value="#{labels.voting_weight_definition_hint}"
                                  styleClass="small form-text text-muted"/>
                </h:panelGrid>

                <!-- allowed file extensions for uploads -->
                <h:outputLabel id="o-allowed-file-extensions"
                               for="it-allowed-file-extensions"
                               value="#{labels.allowed_file_extensions}"/>
                <h:inputTextarea id="it-allowed-file-extensions"
                                 value="#{adminBacker.configuration.allowedFileExtensions}"
                                 a:maxlength="#{Constants.SMALL_AREA}"
                                 styleClass="form-control#{component.valid ? '' : ' error'}">
                    <f:validateLength maximum="#{Constants.SMALL_AREA}"/>
                    <f:validateRegex pattern="#{Constants.EXTENSION_LIST_REGEX}"/>
                </h:inputTextarea>
                <h:panelGroup/>
                <h:panelGroup>
                    <h:message for="it-allowed-file-extensions" styleClass="error"/>
                    <h:outputLabel id="ot-allowed-file-extensions-hint"
                                  value="#{labels.allowed_file_extensions_hint}"
                                  styleClass="small form-text text-muted"/>
                </h:panelGroup>

                <!-- maximum number of attachments per post -->
                <h:outputLabel id="o-max-attachments-per-post"
                               for="it-max-attachments-per-post"
                               value="#{labels.max_attachments_per_post}"/>
                <h:inputText id="it-max-attachments-per-post"
                             value="#{adminBacker.configuration.maxAttachmentsPerPost}"
                             styleClass="form-control#{component.valid ? '' : ' error'}"
                             a:maxlength="#{Constants.SMALL_FIELD}"
                             validatorMessage="#{messages.validate_nonnegative_number}">
                    <f:validateLongRange minimum="0" maximum="#{Constants.SMALL_FIELD}"/>
                </h:inputText>
                <h:panelGroup/>
                <h:message for="it-max-attachments-per-post" styleClass="error"/>
            </h:panelGrid>
            <h:commandButton value="#{labels.save}"
                             action="#{adminBacker.saveConfiguration}"
                             styleClass="btn btn-primary"/>
        </h:form>
    </ui:define>
</ui:composition>
</html>