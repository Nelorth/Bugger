<ui:composition
        xmlns="http://www.w3.org/1999/xhtml"
        xmlns:h="http://xmlns.jcp.org/jsf/html"
        xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
        xmlns:f="http://xmlns.jcp.org/jsf/core">

    <h:panelGroup id="p-header" layout="block" styleClass="d-flex p-3">
        <h:panelGroup layout="block"
                      id="p-organization"
                      styleClass="d-flex justify-content-start flex-grow-1 flex-basis-0 align-items-center h-100">
            <h:link outcome="pretty:home"
                    id="l-logo"
                    styleClass="d-flex align-items-center h-100">
                <h:graphicImage id="g-logo"
                                value="/logo"
                                styleClass="h-100 w-auto me-3"
                                rendered="#{applicationSettings.organization.existsLogo}"/>
                <h:graphicImage id="g-logo-fallback"
                                library="images"
                                name="bugger.png"
                                styleClass="h-100 w-auto me-3"
                                rendered="#{not applicationSettings.organization.existsLogo}"/>
                <h:outputText value="#{applicationSettings.organization.name}"
                              id="ot-comp-name"
                              styleClass="display-6"/>
            </h:link>
        </h:panelGroup>
        <h:panelGroup layout="block"
                      id="p-search-bar"
                      styleClass="d-flex justify-content-center align-items-center mx-5 px-5 col">
            <h:form styleClass="d-flex justify-content-center align-items-center col"
                    id="f-search-header">
                <h:panelGroup styleClass="col">
                    <h:inputText styleClass="form-control form-text mt-0 me-3"
                                 id="it-search" value="#{headerBacker.search}">
                        <f:ajax listener="#{headerBacker.updateSuggestions}" event="keyup"
                                render="p-search-suggestions"/>
                    </h:inputText>
                    <h:panelGroup id="p-search-suggestions" layout="block" styleClass="header-search-suggestions">
                        <ui:repeat value="#{empty headerBacker.userSearchSuggestion ? null
                                : headerBacker.userSearchSuggestion}" var="user">
                            <h:link value="#{user}" outcome="pretty:search" styleClass="row search">
                                <f:param name="t" value="USER"/>
                                <f:param name="q" value="#{user}"/>
                            </h:link>
                        </ui:repeat>
                        <ui:repeat value="#{empty headerBacker.topicSearchSuggestion ? null
                                : headerBacker.topicSearchSuggestion}" var="topic">
                            <h:link value="#{topic}" outcome="pretty:search" styleClass="row search">
                                <f:param name="t" value="TOPIC"/>
                                <f:param name="q" value="#{topic}"/>
                            </h:link>
                        </ui:repeat>
                        <ui:repeat value="#{empty headerBacker.reportSearchSuggestion ? null
                                : headerBacker.reportSearchSuggestion}" var="report">
                            <h:link value="#{report}" outcome="pretty:search" styleClass="row search">
                                <f:param name="t" value="REPORT"/>
                                <f:param name="q" value="#{report}"/>
                            </h:link>
                        </ui:repeat>
                    </h:panelGroup>
                </h:panelGroup>
                <h:commandButton value="#{labels.search}"
                                 action="#{headerBacker.executeSearch}"
                                 styleClass="button btn btn-outline-primary"
                                 id="cb-search">
                </h:commandButton>
            </h:form>
        </h:panelGroup>
        <h:panelGroup layout="block"
                      id="p-authentication"
                      styleClass="d-flex justify-content-end align-items-center flex-grow-1 flex-basis-0"
                      rendered="#{userSession.user == null}">
            <h:link id="l-login"
                    value="#{labels.login}"
                    styleClass="button btn btn-primary me-3"
                    outcome="pretty:login">
                <f:param name="url" value="#{headerBacker.redirectUrl}"/>
            </h:link>
            <h:link id="b-register"
                    value="#{labels.register}"
                    styleClass="button btn btn-primary"
                    outcome="pretty:register"/>
        </h:panelGroup>
        <h:panelGroup layout="block"
                      id="p-profile-menu-toggle"
                      styleClass="d-flex justify-content-end align-items-center flex-grow-1 flex-basis-0"
                      rendered="#{userSession.user != null}">
            <h:form>
                <h:commandButton value="#{labels.menu}"
                                 action="#{headerBacker.toggleMenu}"
                                 immediate="true"
                                 styleClass="btn btn#{headerBacker.displayMenu ? '-outline' : ''}-primary">
                    <f:param name="d" value="#{headerBacker.displayMenu}"/>
                </h:commandButton>
            </h:form>
        </h:panelGroup>
        <h:panelGroup rendered="#{userSession.user != null and headerBacker.displayMenu}"
                      layout="block"
                      id="p-profile-menu">
            <h:panelGroup styleClass="row" layout="block">
                <h:outputText value="#{headerBacker.user.firstName}" id="ot-first-name"/>
                <h:outputText value="#{headerBacker.user.lastName}" id="ot-last-name"/>
            </h:panelGroup>
            <h:panelGroup styleClass="row" layout="block">
                <h:outputText value="@#{headerBacker.user.username}" id="ot-username"/>
                <h:outputText value="(Admin)" id="ot-role" rendered="#{headerBacker.user.administrator}"/>
            </h:panelGroup>
            <h:link value="#{labels.administration}"
                    outcome="pretty:admin"
                    rendered="#{headerBacker.user.administrator}"
                    id="l-configuration"
                    styleClass="dropdown-item"/>
            <h:link value="#{labels.profile}"
                    id="l-profile"
                    outcome="pretty:profile"
                    styleClass="dropdown-item">
                <f:param name="u" value="#{userSession.user.username}"/>
            </h:link>
            <h:panelGroup styleClass="row" layout="block">
                <!-- logout -->
                <h:form>
                    <h:commandButton value="#{labels.logout}" action="#{headerBacker.logout}"
                                     styleClass="btn btn-primary">
                        <f:param name="d" value="#{headerBacker.displayMenu}"/>
                    </h:commandButton>
                </h:form>
            </h:panelGroup>
        </h:panelGroup>
    </h:panelGroup>
</ui:composition>
